/*!
 * Copyright (c) 2009 - 2013 Erik van den Berg (http://www.tweego.nl/jeegoopopup)
 * Licensed under MIT (http://www.opensource.org/licenses/mit-license.php) license.
 * Consider linking back to author's homepage: http://www.tweego.nl
 *
 * Version: 1.0.0
 * Requires jQuery 1.4.2+
 */
(function(h){var u;var m;var d;var B;var e;var b;var w;var v;var i;var A;var y=function(){if(!m){h("body").append('<div id="jg_popup_overlay"></div><div id="jg_popup_inner"><table id="jg_popup_table" cellpadding="0" cellspacing="0" border="0"><tr><td id="jg_popup_tl"></td><td id="jg_popup_title"></td><td id="jg_popup_tr"><div id="jg_popup_close"></div></td></tr><tr><td id="jg_popup_l"></td><td><div id="jg_popup_content"></div><div id="jg_popup_loader"><div></div></div></td><td id="jg_popup_r"></td></tr><tr><td id="jg_popup_bl"></td><td id="jg_popup_b"></td><td id="jg_popup_br"></td></tr></table><div id="jg_popup_garbage" style="display:none"></div></div>');B=300;u=[];m=true}};var g=function(J){if(u.length>0){var C=u[u.length-1];var D={position:C.fixed?"fixed":"absolute"};if(J){h("#jg_popup_inner").css(C.css)}else{var I=h(window);var H=I.scrollLeft();var G=I.scrollTop();if(C.left!=undefined){D.right="auto";D.left=C.fixed?C.left+"px":H+C.left+"px"}else{if(C.right!=undefined){D.left="auto";D.right=C.fixed?C.right+"px":C.right-H+"px"}else{if(C.center){D.right="auto";var F=(I.width()-h("#jg_popup_inner").outerWidth())/2;D.left=C.fixed?F+"px":H+F+"px"}else{D.right="auto";D.left=C.fixed?"0px":H+"px"}}}if(C.top!=undefined){D.bottom="auto";D.top=C.fixed?C.top+"px":G+C.top+"px"}else{if(C.bottom!=undefined){D.top="auto";D.bottom=C.fixed?C.bottom+"px":C.bottom-G+"px"}else{if(C.center){D.bottom="auto";var E=(I.height()-h("#jg_popup_inner").outerHeight())/2;D.top=C.fixed?E+"px":G+E+"px"}else{D.bottom="auto";D.top=C.fixed?"0px":G+"px"}}}h("#jg_popup_inner").css(D);C.css=D}}};var f=function(E){if(u&&u.length>0){var D=u.length-1;var C=u[D].onClose;u.pop();var H=h("#jg_popup_content > div:eq("+D+")");try{var I=H.find("iframe");for(var F=0;F<I.length;F++){h(I[F]).attr("src","about:blank")}}catch(G){}setTimeout(function(){H.appendTo("#jg_popup_garbage")},0);if(D==0){h("#jg_popup_close").unbind("click.jg_popup");h("#jg_popup_title").unbind("mousedown.jg_popup");h(".jg_popup_scroller").removeClass("jg_popup_scroller").css("overflow","auto")}t(true);if(C){if(E){C.apply(window,E)}else{C()}}}};var c=function(){var D=h("#jg_popup_content");var C=u[u.length-1].width;D.css("width",C=="auto"?"auto":C+"px")};var o=function(){var D=h("#jg_popup_content");var C=u[u.length-1].height;if(u[u.length-1].url){if(C!="auto"){h("#jg_popup_content div:eq("+(u.length-1)+") > iframe.jg_popup_iframe").attr("height",C);var E=(C-h("#jg_popup_loader div").height())/2;h("#jg_popup_loader").css("top",(E+u[u.length-1].loaderVerticalOffset)+"px")}else{h("#jg_popup_content div:eq("+(u.length-1)+") > iframe.jg_popup_iframe").removeAttr("height")}h("#jg_popup_content").height("auto")}else{h("#jg_popup_content").height(C)}};var q=function(){var D=u[u.length-1].title;var C=u[u.length-1].maxTitleLength;if(C&&D&&D.length>C){h("#jg_popup_title").html(D.substring(0,C)+"...")}else{h("#jg_popup_title").html(D||"")}};var r=function(){var D=u[u.length-1].parentScrolling;if(D){h(".jg_popup_scroller").removeClass("jg_popup_scroller").css("overflow","auto")}else{var C=h("body");if(C.css("overflow")=="hidden"){C=C.find("*").filter(function(){return h(this).css("overflow")=="auto"}).first()}C.addClass("jg_popup_scroller").css("overflow","hidden")}};var z=function(){h("#jg_popup_table").removeClass().addClass(u[u.length-1].skinClass)};var p=function(){h("#jg_popup_title")[u[u.length-1].draggable?"addClass":"removeClass"]("jg_popup_draggable")};var s=function(){h("#jg_popup_br")[u[u.length-1].resizable?"addClass":"removeClass"]("jg_popup_resizable")};var a=function(){h("#jg_popup_overlay").css("display",u[u.length-1].overlay?"block":"none")};var x=function(){h("#jg_popup_overlay").css("backgroundColor",u[u.length-1].overlayColor)};var l=function(){h("#jg_popup_overlay").css("opacity",u[u.length-1].opacity/100)};var t=function(F){if(u.length<=0){d=false;h("#jg_popup_overlay, #jg_popup_inner").hide()}else{var C=h("#jg_popup_content > div:eq("+(u.length-1)+")");if(!d){h("#jg_popup_inner").css("visibility","hidden")}else{h("#jg_popup_content > div:lt("+(u.length-1)+")").hide();C.show()}q();c();o();r();z();p();s();a();x();l();if((u[u.length-1].width=="auto"||u[u.length-1].height=="auto")&&u[u.length-1].center&&C.find("img").length>0&&document.createElement("img").complete!=undefined){var E=C.find("img:eq(0)").get()[0];var D=setInterval(function(){if(E.complete){clearInterval(D);if(u.length>0){g(F);h("#jg_popup_inner").css({visibility:"visible",display:"none"});h("#jg_popup_inner").fadeIn(B,function(){if(u.length>0&&u[u.length-1].onOpen){u[u.length-1].onOpen()}})}}},50)}else{g(F);if(!d){h("#jg_popup_inner").css({visibility:"visible",display:"none"});h("#jg_popup_inner").fadeIn(B,function(){if(u.length>0&&u[u.length-1].onOpen){u[u.length-1].onOpen()}})}else{if(u.length>0&&u[u.length-1].onOpen){u[u.length-1].onOpen()}}}d=true}};var n=function(E){var C=u[u.length-1];if(!C.draggable){return}w=E.pageX;v=E.pageY;var G=h("#jg_popup_inner").offset();var D=h("#jg_popup_inner").css("position")=="fixed";var F=h(window);e=G.left-(D?F.scrollLeft():0);b=G.top-(D?F.scrollTop():0);if(C.onDragStart){C.onDragStart(C)}h('<div id="jg_drag_aid"></div>').css({opacity:0,background:"#000",width:"100%",height:"100%",position:"fixed",left:0,top:0,cursor:"move"}).appendTo("#jg_popup_content");h(document).unbind("mousemove.jg_popup_drag").bind("mousemove.jg_popup_drag",function(K){var J=(e+(K.pageX-w));var I=(b+(K.pageY-v));var H={left:J+"px",top:I+"px",right:"auto",bottom:"auto"};h("#jg_popup_inner").css(H);C.left=J;C.top=I;C.css=H;if(C.onDrag){C.onDrag(C)}}).unbind("mouseup.jg_popup_drag").bind("mouseup.jg_popup_drag",function(H){h("#jg_drag_aid").remove();h(this).unbind(".jg_popup_drag");if(C.onDragEnd){C.onDragEnd(C)}})};var j=function(D){var C=u[u.length-1];if(!C.resizable){return}w=D.pageX;v=D.pageY;i=C.width;if(i=="auto"){i=h("#jg_popup_content").width()}A=u[u.length-1].height;if(A=="auto"){A=h("#jg_popup_content").height()}if(C.onResizeStart){C.onResizeStart(C)}h('<div id="jg_drag_aid"></div>').css({opacity:0,background:"#000",width:"100%",height:"100%",position:"fixed",left:0,top:0,cursor:"move"}).appendTo("#jg_popup_content");h(document).unbind("mousemove.jg_popup_resize").bind("mousemove.jg_popup_resize",function(E){u[u.length-1].width=i+(E.pageX-w);u[u.length-1].height=A+(E.pageY-v);c();o();if(C.onResize){C.onResize(C)}}).unbind("mouseup.jg_popup_resize").bind("mouseup.jg_popup_resize",function(E){h("#jg_drag_aid").remove();h(this).unbind(".jg_popup_resize");if(C.onResizeEnd){C.onResizeEnd(C)}})};var k=function(C){return(u&&u.length>0)?u[u.length-1][C]:null};h.jeegoopopup={open:function(D){y();try{h("#jg_popup_garbage").empty()}catch(E){}var C=h.extend({width:"auto",height:"auto",scrolling:"auto",skinClass:"jg_popup_basic",fixed:true,center:true,overlay:true,overlayColor:"#000",opacity:50,loaderVerticalOffset:0,parentScrolling:true,draggable:true,resizable:true},D||{});u.push(C);if(D&&D.fadeIn!=undefined){B=D.fadeIn}if(u.length>1&&!C.center){var F=h("#jg_popup_inner").offset();if(C.top==undefined&&C.bottom==undefined){C.top=C.fixed?F.top-h(window).scrollTop():F.top}if(C.left==undefined&&C.right==undefined){C.left=C.fixed?F.left-h(window).scrollLeft():F.left}}if(C.url){var H="jgpopup"+Math.random().toString().replace(/\D/,"");h("#jg_popup_loader").css("visibility","visible");h("#jg_popup_content").append('<div><iframe id="'+H+'" class="jg_popup_iframe" onload="(function(){$(\'#jg_popup_loader\').css(\'visibility\', \'hidden\');})()" frameborder="0" scrolling="'+C.scrolling+'" width="100%" '+(C.height=="auto"?"":'height="'+C.height+'px" ')+'src="'+C.url+'"></iframe></div>')}else{var G=C.scrolling;if(G=="yes"){G="scroll"}else{if(G=="no"){G="hidden"}}h("#jg_popup_content").append('<div style="width:100%;height:100%;overflow:'+G+'">'+(C.html||"")+"</div>")}if(u.length==1){h("#jg_popup_close").unbind("click.jg_popup").bind("click.jg_popup",function(){f()});h("#jg_popup_title").unbind("mousedown.jg_popup").bind("mousedown.jg_popup",n);h("#jg_popup_br").unbind("mousedown.jg_popup").bind("mousedown.jg_popup",j)}t()},close:function(){f(arguments)},opacity:function(C){if(C==undefined){return k("opacity")}else{if(u&&u.length>0){u[u.length-1].opacity=C;l()}}return this},overlay:function(C){if(C==undefined){return k("overlay")}else{if(u&&u.length>0){u[u.length-1].overlay=C;a()}}return this},overlayColor:function(C){if(C==undefined){return k("overlayColor")}else{if(u&&u.length>0){u[u.length-1].overlayColor=C;x()}}return this},draggable:function(C){if(C==undefined){return k("draggable")}else{if(u&&u.length>0){u[u.length-1].draggable=C;p()}}return this},resizable:function(C){if(C==undefined){return k("resizable")}else{if(u&&u.length>0){u[u.length-1].resizable=C;s()}}return this},fixed:function(C){if(C==undefined){return k("fixed")}else{if(u&&u.length>0){u[u.length-1].fixed=C;g()}}return this},height:function(C){if(C==undefined){return k("height")}else{if(u&&u.length>0){u[u.length-1].height=C;o()}}return this},width:function(C){if(C==undefined){return k("width")}else{if(u&&u.length>0){u[u.length-1].width=C;c()}}return this},top:function(C){if(C==undefined){return k("top")}else{if(u&&u.length>0){u[u.length-1].top=C;h("#jg_popup_inner").css({top:k("fixed")?C+"px":h(window).scrollTop()+C+"px",bottom:"auto"})}}return this},left:function(C){if(C==undefined){return k("left")}else{if(u&&u.length>0){u[u.length-1].left=C;h("#jg_popup_inner").css({left:k("fixed")?C+"px":h(window).scrollLeft()+C+"px",right:"auto"})}}return this},right:function(C){if(C==undefined){return k("right")}else{if(u&&u.length>0){u[u.length-1].right=C;u[u.length-1].left=undefined;h("#jg_popup_inner").css({right:k("fixed")?C+"px":C-h(window).scrollLeft()+"px",left:"auto"})}}return this},bottom:function(C){if(C==undefined){return k("bottom")}else{if(u&&u.length>0){u[u.length-1].bottom=C;u[u.length-1].top=undefined;h("#jg_popup_inner").css({bottom:k("fixed")?C+"px":C-h(window).scrollTop()+"px",top:"auto"})}}return this},title:function(C){if(C==undefined){return k("title")}else{if(u&&u.length>0){u[u.length-1].title=C;q(C,u[u.length-1].maxTitleLength)}}return this},maxTitleLength:function(C){if(C==undefined){return k("maxTitleLength")}else{if(u&&u.length>0){u[u.length-1].maxTitleLength=C;q(u[u.length-1].title,C)}}return this},skinClass:function(C){if(C==undefined){return k("skinClass")}else{if(u&&u.length>0){u[u.length-1].skinClass=C;z()}}return this},parentScrolling:function(C){if(C==undefined){return k("parentScrolling")}else{if(u&&u.length>0){u[u.length-1].parentScrolling=C;r()}}return this},center:function(){if(u&&u.length>0){var G=h(window);var C=u[u.length-1];var F=(G.width()-h("#jg_popup_inner").outerWidth())/2;var E=(G.height()-h("#jg_popup_inner").outerHeight())/2;var D={left:C.fixed?F+"px":G.scrollLeft()+F+"px",top:C.fixed?E+"px":G.scrollTop()+E+"px",right:"auto",bottom:"auto"};C.css=D;h("#jg_popup_inner").css(D)}return this},refresh:function(){if(u&&u.length>0){var C=h("#jg_popup_content div:eq("+(u.length-1)+") > iframe.jg_popup_iframe");if(C.length>0){C[0].contentDocument.location.reload(true)}}return this}}})(jQuery);